From 211950c4d02f45fcb757ab0b7b06d8706006fb74 Mon Sep 17 00:00:00 2001
From: Yifan Liu <yifan1.liu@intel.com>
Date: Thu, 10 Feb 2022 06:39:43 +0000
Subject: [PATCH 4/6] hv: WA: Allow acrntrace/acrnlog hypercall access to REE

This patch allows hcall_setup_sbuf from REE.

Signed-off-by: Yifan Liu <yifan1.liu@intel.com>
---
 hypervisor/arch/x86/guest/vmcall.c | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/hypervisor/arch/x86/guest/vmcall.c b/hypervisor/arch/x86/guest/vmcall.c
index 13ae5a880..cabd03e55 100644
--- a/hypervisor/arch/x86/guest/vmcall.c
+++ b/hypervisor/arch/x86/guest/vmcall.c
@@ -87,7 +87,8 @@ static const struct hc_dispatch hc_dispatch_table[] = {
 	[HC_IDX(HC_VM_INTR_MONITOR)] = {
 		.handler = hcall_vm_intr_monitor},
 	[HC_IDX(HC_SETUP_SBUF)] = {
-		.handler = hcall_setup_sbuf},
+		.handler = hcall_setup_sbuf,
+		.permission_flags = GUEST_FLAG_REE},
 	[HC_IDX(HC_SETUP_HV_NPK_LOG)] = {
 		.handler = hcall_setup_hv_npk_log},
 	[HC_IDX(HC_PROFILING_OPS)] = {
-- 
2.25.1

